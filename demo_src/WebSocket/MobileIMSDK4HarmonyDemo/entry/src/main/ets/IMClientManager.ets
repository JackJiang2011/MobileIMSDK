/*
 * Copyright (C) 2024  å³æ—¶é€šè®¯ç½‘(52im.net) & Jack Jiang.
 * The MobileIMSDK-é¸¿è’™Nextå®¢æˆ·ç«¯ Project. All rights reserved.
 *
 * è”ç³»é‚®ä»¶ï¼šjack.jiang@52im.net
 * è”ç³»å¾®ä¿¡ï¼šhellojackjiang
 * è”ç³»QQï¼š 413980957
 * æŠ€æœ¯ç¤¾åŒºï¼šhttp://www.52im.net
 */

import { ClientCoreSDK, LogLevel, SenseMode, LogUtils, SocketEvent, PLoginInfoResponse, Logger, Protocal, PErrorResponse, ErrorCode, PKickoutInfo, AutoReLoginDaemon, KeepAliveDaemon, LocalDataReciever, LocalDataSender, LocalSocketProvider, QoS4ReciveDaemon, QoS4SendDaemon } from "mobileimsdk/Index";
import { common } from "@kit.AbilityKit";
import UIEvent from "./pages/constants/UIEvent";
import Message from "./pages/model/Message";
import MessagesProvider from "./pages/model/MessagesProvider";
import MsgSendStatus from "./pages/constants/MsgSendStatus";

const TAG: string = '[IMClientManager] ';

// MobileIMSDKæœåŠ¡ç«¯çš„WebSocketæœåŠ¡åœ°å€ï¼ˆå¦‚æœåŠ¡ç«¯å·²å¼€å¯SSLï¼Œæ­¤å¤„è¯·ä½¿ç”¨wssï¼‰
const IM_SERVER_URL: string = 'ws://rbcore.52im.net:3000/websocket';// TODO: é»˜è®¤åœ°å€æ˜¯å®˜æ–¹æ¼”ç¤ºæœåŠ¡ï¼Œéœ€è¦æ”¹æˆè¿æ¥æ‚¨è‡ªå·²çš„æœåŠ¡ç«¯

/**
 * MobileIMSDKçš„ç®¡ç†ç±»ã€‚
 *
 * @author Jack Jiang(http://www.52im.net/thread-2792-1-1.html)
 */
export default class IMClientManager {

  /** æœ¬ç±»çš„å…¨å±€å•ä¾‹ */
  private static instance: IMClientManager;

  /** MobileIMSDKæ˜¯å¦å·²è¢«åˆå§‹åŒ–. trueè¡¨ç¤ºå·²åˆåŒ–å®Œæˆï¼Œå¦åˆ™æœªåˆå§‹åŒ–. */
  private init: boolean = false;

  /** applicationå¯¹è±¡å¼•ç”¨ï¼ˆæš‚æ—¶æ²¡ç”¨åˆ°ï¼Œå…ˆç•™ç€å§ï¼‰ */
  private application?: common.ApplicationContext;

  /** èŠå¤©æ¶ˆæ¯çš„ç¼“å­˜æ•°æ®æä¾›è€…å¯¹è±¡ï¼ˆé›†ä¸­ç®¡ç†æ‰€æœ‰çš„èŠå¤©æ¶ˆæ¯å’ŒæŒ‡ä»¤ï¼Œæ¶ˆæ¯çš„UIå±‚æ˜¾ç¤ºå°†é€šè¿‡MessagesDataSourceä¸UIç•Œé¢è§£å¶ï¼‰*/
  private messageProvider: MessagesProvider = new MessagesProvider();

  /**
   * è·å¾—æœ¬ç±»çš„å…¨å±€å•ä¾‹ã€‚
   *
   * @returns IMClientManagerå•ä¾‹
   */
  static getInstance(): IMClientManager {
    if (!IMClientManager.instance) {
      IMClientManager.instance = new IMClientManager();
    }
    return IMClientManager.instance;
  }

  private constructor() {
  }

  /**
   * MobileIMSDKçš„åˆå§‹åŒ–æ–¹æ³•ã€‚åœ¨ä½¿ç”¨MobileIMSDKè¯·åŠ¡å¿…ç¡®ä¿å…ˆè°ƒç”¨ä¸€æ¬¡æœ¬æ–¹æ³•ã€‚
   *
   * @param application applicationå¯¹è±¡å¼•ç”¨
   * @param eventHub EventHubè®¢é˜…å¯¹è±¡ï¼ˆç”¨äºäº‹ä»¶åˆ†å‘ï¼‰
   */
  initMobileIMSDK(application: common.ApplicationContext, eventHub: common.EventHub): void {
    if (!this.init) {
      this.application = application;

      //* ã€ç‰¹åˆ«æ³¨æ„ã€‘è¯·ç¡®ä¿é¦–å…ˆè¿›è¡Œæ ¸å¿ƒåº“çš„åˆå§‹åŒ–ï¼ˆè¿™æ˜¯ä¸åŒäºiOSå’ŒJavaç«¯çš„åœ°æ–¹ï¼Ÿ)
      ClientCoreSDK.getInstance().init(eventHub);

      //* å¼€å¯Debugå¼€å…³å°†è¾“å‡ºç›¸å…³çš„logï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå¹³æ—¶å»ºè®®å…³é—­ä¹‹
      ClientCoreSDK.DEBUG = true;
      AutoReLoginDaemon.DEBUG = true;
      KeepAliveDaemon.DEBUG = true;
      LocalDataReciever.DEBUG = true;
      LocalDataSender.DEBUG = true;
      LocalSocketProvider.DEBUG = true;
      QoS4ReciveDaemon.DEBUG = true;
      QoS4SendDaemon.DEBUG = true;

      //* è®¾ç½®æœåŠ¡å™¨çš„websocketè¿æ¥åœ°å€
      ClientCoreSDK.websocketUrl = IM_SERVER_URL;

      //* SDKæ ¸å¿ƒIMæ¡†æ¶çš„æ•æ„Ÿåº¦æ¨¡å¼è®¾ç½®ï¼ˆé»˜è®¤MBSenseMode.MODE_5Sï¼Œæ­¤è®¾ç½®å¿…é¡»ä¸æœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼ï¼ï¼‰
      SenseMode.setSenseMode(SenseMode.MODE_3S);

      //* è®¾ç½®é»˜è®¤çš„æ—¥å¿—è¾“å‡ºçº§åˆ«
      LogUtils.setLevel(LogLevel.DEBUG);//(LogLevel.WARN);//

      //* æ³¨å†ŒMobileIMSDKæ¡†æ¶å¼€æ”¾å„ç§äº‹ä»¶ç›‘å¬
      this.registerSocketEvent();

      //* è®¾ç½®å·²è¢«åˆå§‹åŒ–æ ‡è¯†
      this.init = true;
    }
  }

  /**
   * é‡Šæ”¾IMæ¡†æ¶æ‰€å ç”¨çš„èµ„æºï¼Œåœ¨é€€å‡ºç™»é™†æ—¶è¯·åŠ¡å¿…è°ƒç”¨æœ¬æ–¹æ³•ï¼Œå¦åˆ™é‡æ–°ç™»é™†å°†ä¸èƒ½æ­£å¸¸å®ç°ï¼ˆæŒ‡APPè¿›ç¨‹ä¸é€€å‡ºæ—¶åˆ‡æ¢è´¦å·è¿™ç§æƒ…å†µï¼‰ã€‚
   */
  releaseMobileIMSDK(): void {
    // é‡Šæ”¾IMæ ¸å¿ƒåº“èµ„æº
    ClientCoreSDK.getInstance().release();
    // é‡ç½®æœ¬ç±»çš„åˆå§‹åŒ–æ ‡è¯†
    this.resetInitFlag();
    // å–æ¶ˆæ³¨å†Œäº‹ä»¶ç›‘å¬
    this.unregisterSocketEvent();
    // æ¸…ç©ºèŠå¤©æ•°æ®
    this.messageProvider.clear();
  }

  /**
   * æ³¨å†ŒMobileIMSDKæ¡†æ¶å¼€æ”¾å„ç§äº‹ä»¶ç›‘å¬ã€‚
   */
  private registerSocketEvent() {
    let emiter: common.EventHub = this.getEmitter();


    /*
     * æœ¬åœ°ç”¨æˆ·çš„ç™»é™†ç»“æœå›è°ƒäº‹ä»¶é€šçŸ¥ï¼ˆæ­¤äº‹ä»¶å‘ç”Ÿæ—¶è¡¨ç¤ºå®¢æˆ·ç«¯å·²ç™»é™†/è¿æ¥æˆ–é‡è¿å®Œæˆï¼‰ã€‚
     *
     * @param loginInfoRes å³PLoginInfoResponseå¯¹è±¡ï¼ŒAPIæ–‡æ¡£åœ°å€ï¼šhttp://docs.52im.net/extend/docs/api/mobileimsdk/server_tcp/net/x52im/mobileimsdk/server/protocal/s/PLoginInfoResponse.html
     */
    emiter.on(SocketEvent.SOCKET_EVENT_ON_LOGIN_RESPONSE, (loginInfoRes: PLoginInfoResponse) => {
      if (loginInfoRes) {
        // è¿”å›ç ï¼ˆç”¨äºè·çŸ¥è¢«æœåŠ¡ç«¯æ˜¯å¦æ­£ç¡®ç™»é™†è¯çš„å…³é”®è¿”å›ç ï¼‰
        let code = loginInfoRes.code;
        this.getLog().info('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯ SOCKET_EVENT_ON_LOGIN_RESPONSE äº‹ä»¶å·²ç»è§¦å‘âœ…ï¼ˆcode=' + code + 'ï¼‰');

        //  è®¤è¯æˆåŠŸ
        if (0 === code) { // æ¯æ¬¡æ‰çº¿éƒ½ä¼šé‡æ–°èµ°ä¸€éè®¤è¯è¿‡ç¨‹
          // // é€šçŸ¥åº”ç”¨å±‚å¯¹ç™»é™†ç»“æœå¤„ç†å±•ç°æˆ–å¤„ç†
          // emiter.emit(UIEvent.UIEVENT_onIMAfterLoginSucess, code);

          this.getLog().info("[åº”ç”¨å±‚]  â— â— â— â— â—ã€å·²æˆåŠŸç™»å½•æˆ–é‡è¿è‡³ MobileIMSDK æœåŠ¡å™¨ã€‘â— â— â— â— â—");
        }
        // æœªè®¤è¯æˆåŠŸï¼ˆè®¤è¯å¤±è´¥äº†ï¼‰
        else {
          // // é€šçŸ¥åº”ç”¨å±‚å¯¹ç™»é™†ç»“æœå¤„ç†å±•ç°æˆ–å¤„ç†
          // emiter.emit(UIEvent.UIEVENT_onIMAfterLoginFailed, code);

          this.getLog().error('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯çš„ SOCKET_EVENT_ON_LOGIN_RESPONSE äº‹ä»¶ä¸­ï¼šç™»é™†è®¤è¯å¤±è´¥âã€code=' + code + 'ã€‘');
        }

        // é€šçŸ¥åº”ç”¨å±‚å¯¹ç™»é™†ç»“æœè¿›è¡Œå±•ç°æˆ–å…¶å®ƒå¤„ç†
        emiter.emit(UIEvent.UIEVENT_onIMAfterLoginComplete, code);
      } else {
        this.getLog().error('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯çš„ SOCKET_EVENT_ON_LOGIN_RESPONSE äº‹ä»¶æˆåŠŸè¿”å›ï¼Œä½†è¿”å›çš„loginInfoResæ˜¯ç©ºçš„âœ´ï¸ï¼');
      }
    });

    /*
     * ä¸æœåŠ¡ç«¯çš„é€šä¿¡æ–­å¼€çš„å›è°ƒäº‹ä»¶é€šçŸ¥ï¼ˆæ­¤äº‹ä»¶å‘ç”Ÿæ—¶è¡¨ç¤ºå®¢æˆ·ç«¯å·²æ‰çº¿ï¼‰ã€‚
     * è¯¥æ¶ˆæ¯åªæœ‰åœ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨æˆåŠŸä¹‹åç½‘ç»œå¼‚å¸¸ä¸­æ–­ä¹‹æ—¶è§¦å‘ã€‚<br>
     * å¯¼è‡´ä¸ä¸æœåŠ¡ç«¯çš„é€šä¿¡æ–­å¼€çš„åŸå› æœ‰ï¼ˆä½†ä¸é™äºï¼‰ï¼šæ— çº¿ç½‘ç»œä¿¡å·ä¸ç¨³å®šã€WiFiä¸2G/3G/4G/5Gç­‰åŒå¼€æƒ…å†µä¸‹çš„ç½‘ç»œåˆ‡æ¢ã€æ‰‹æœºç³»ç»Ÿçš„çœç”µç­–ç•¥ç­‰ã€‚
     *
     * @param code æœ¬å›è°ƒå‚æ•°è¡¨ç¤ºè¡¨ç¤ºè¿æ¥æ–­å¼€çš„åŸå› ï¼Œç›®å‰é”™è¯¯ç æ²¡æœ‰å¤ªå¤šæ„ä¹‰ï¼Œä»…ä½œä¿ç•™å­—æ®µï¼Œç›®å‰é€šå¸¸ä¸º-1
     */
    emiter.on(SocketEvent.SOCKET_EVENT_ON_LINK_CLOSE, (code: number) => {
      this.getLog().warn('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯ SOCKET_EVENT_ON_LINK_CLOSE äº‹ä»¶å·²ç»è§¦å‘âŒã€ENDã€‘ï¼Œ(å¯¹ä¸èµ·ï¼Œä½ ä¸IMæœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥æ–­å¼€äº†(æ‰çº¿ç½—))!');
      // é€šçŸ¥åº”ç”¨å±‚ç½‘ç»œæ‰çº¿äº†
      emiter.emit(UIEvent.UIEVENT_onIMDisconnected);
    });

    /*
     * æ”¶åˆ°æ™®é€šæ¶ˆæ¯çš„å›è°ƒäº‹ä»¶é€šçŸ¥ï¼ˆæ­¤äº‹ä»¶è¡¨ç¤ºæ”¶åˆ°IMæ¶ˆæ¯äº†ï¼‰ã€‚
     * åº”ç”¨å±‚å¯ä»¥å°†æ­¤æ¶ˆæ¯è¿›ä¸€æ­¥æŒ‰è‡ªå·²çš„IMåè®®è¿›è¡Œå®šä¹‰ï¼Œä»è€Œå®ç°å®Œæ•´çš„å³æ—¶é€šä¿¡è½¯ä»¶é€»è¾‘ã€‚
     *
     * @param protocal Protocalå¯¹è±¡ï¼Œè§ï¼šhttp://docs.52im.net/extend/docs/api/mobileimsdk/server_netty/net/openmob/mobileimsdk/server/protocal/Protocal.html
     */
    emiter.on(SocketEvent.SOCKET_EVENT_ON_RECIEVE_MESSAGE, (protocal: Protocal) =>{

      this.getLog().info('[åº”ç”¨å±‚]  >> æ”¶åˆ°[èŠå¤©æ¶ˆæ¯]ğŸ“©ï¼š' + JSON.stringify(protocal));

      let m = Message.createChatMsgEntity_INCOME_TEXT(protocal.from, 'UID: '+protocal.from, protocal.dataContent, 0);
      m.fingerPrintOfProtocal = protocal.fp;
      // å°†æ”¶åˆ°çš„æ¶ˆæ¯æ”¾å…¥å…¨å±€æ¶ˆæ¯ç¼“å­˜é›†åˆä¸­ï¼ˆMessageProvider.putMessage()æ–¹æ³•ä¸­ä¼šåŒæ—¶é€šçŸ¥uiå±‚è¿›è¡Œåˆ·æ–°æ˜¾ç¤ºï¼‰
      this.messageProvider.putMessage(m);
    });

    /*
     * æœåŠ¡ç«¯åé¦ˆçš„å‡ºé”™ä¿¡æ¯å›è°ƒäº‹ä»¶é€šçŸ¥ã€‚
     *
     * @param errorCode é”™è¯¯ç ï¼Œå®šä¹‰åœ¨å¸¸é‡è¡¨ ErrorCode.ForS ç±»ä¸­ï¼Œè§ï¼šhttp://docs.52im.net/extend/docs/api/mobileimsdk/server/net/openmob/mobileimsdk/server/protocal/ErrorCode.ForS.html
     * @param errorMsg æè¿°é”™è¯¯å†…å®¹çš„æ–‡æœ¬ä¿¡æ¯
     */
    emiter.on(SocketEvent.SOCKET_EVENT_ON_ERROR_RESPONSE, (errorRes: PErrorResponse) =>{
      this.getLog().error("[åº”ç”¨å±‚]  æ”¶åˆ°æœåŠ¡ç«¯é”™è¯¯æ¶ˆæ¯ğŸ›‘ï¼ŒerrorCode=" + errorRes.errorCode + ", errorMsg=" + errorRes.errorMsg);
      if (errorRes.errorCode === ErrorCode.RESPONSE_FOR_UNLOGIN) {
        //this.getLog().error(TAG+ "æœåŠ¡ç«¯ä¼šè¯å·²å¤±æ•ˆï¼Œè‡ªåŠ¨ç™»é™†/é‡è¿å°†å¯åŠ¨! ("+errorCode+")");
      } else {
        //this.getLog().error(TAG+ "Serveråé¦ˆé”™è¯¯ç ï¼š" + errorCode + ",errorMsg=" + errorMsg);
      }
    });

    /*
     * æ¶ˆæ¯æœªé€è¾¾çš„å›è°ƒäº‹ä»¶é€šçŸ¥.
     *
     * @param lostMessages ç”±MobileIMSDK QoSç®—æ³•åˆ¤å®šå‡ºæ¥çš„æœªé€è¾¾æ¶ˆæ¯åˆ—è¡¨ï¼Œåº”ç”¨å±‚å¯é€šè¿‡æŒ‡çº¹ç‰¹å¾ç æ‰¾åˆ°åŸæ¶ˆæ¯å¹¶å¯ä»¥UIä¸Šå°†å…¶æ ‡è®°ä¸ºâ€å‘é€å¤±è´¥â€œä»¥ä¾¿å³æ—¶å‘Šä¹‹ç”¨æˆ·
     */
    emiter.on(SocketEvent.SOCKET_EVENT_MESSAGE_LOST, (lostMessages: Protocal[]) => {
      if (lostMessages && lostMessages.length > 0) {
        this.getLog().info('[åº”ç”¨å±‚]  æ”¶åˆ°ç³»ç»Ÿçš„æœªå®æ—¶é€è¾¾äº‹ä»¶é€šçŸ¥ï¼Œå½“å‰å…±æœ‰' + lostMessages.length +'ä¸ªåŒ…QoSä¿è¯æœºåˆ¶ç»“æŸï¼Œåˆ¤å®šä¸ºã€æ— æ³•å®æ—¶é€è¾¾ğŸ˜¡ã€‘ï¼');

        // æ›´æ–°æœªé€è¾¾æ¶ˆæ¯çš„å‘é€çŠ¶æ€ï¼ˆMessageProvider.updateMessagesSendStatus()æ–¹æ³•ä¸­ä¼šåŒæ—¶é€šçŸ¥uiå±‚è¿›è¡Œåˆ·æ–°æ˜¾ç¤ºï¼‰
        this.messageProvider.updateMessagesSendStatus(lostMessages, MsgSendStatus.sendFaild);
      }
    });

    /*
     * æ¶ˆæ¯å·²è¢«å¯¹æ–¹æ”¶åˆ°çš„å›è°ƒäº‹ä»¶é€šçŸ¥.
     *
     * ç›®å‰ï¼Œåˆ¤å®šæ¶ˆæ¯è¢«å¯¹æ–¹æ”¶åˆ°æ˜¯æœ‰ä¸¤ç§å¯èƒ½ï¼š
     *  1) å¯¹æ–¹ç¡®å®æ˜¯åœ¨çº¿å¹¶ä¸”å®æ—¶æ”¶åˆ°äº†ï¼›
     *  2) å¯¹æ–¹ä¸åœ¨çº¿æˆ–è€…æœåŠ¡ç«¯è½¬å‘è¿‡ç¨‹ä¸­å‡ºé”™äº†ï¼Œç”±æœåŠ¡ç«¯è¿›è¡Œç¦»çº¿å­˜å‚¨æˆåŠŸåçš„åé¦ˆï¼ˆæ­¤ç§æƒ…å†µä¸¥æ ¼æ¥è®²ä¸èƒ½ç®—æ˜¯â€œå·²è¢«
     * 		æ”¶åˆ°â€ï¼Œä½†å¯¹äºåº”ç”¨å±‚æ¥è¯´ï¼Œç¦»çº¿å­˜å‚¨äº†çš„æ¶ˆæ¯åŸåˆ™ä¸Šå°±æ˜¯å·²é€è¾¾äº†çš„æ¶ˆæ¯ï¼šå› ä¸ºç”¨æˆ·ä¸‹æ¬¡ç™»é™†æ—¶è‚¯å®šèƒ½é€šè¿‡HTTPåè®®å–åˆ°ï¼‰ã€‚
     *
     * @param theFingerPrint {String} å·²è¢«æ”¶åˆ°çš„æ¶ˆæ¯çš„æŒ‡çº¹ç‰¹å¾ç ï¼ˆå”¯ä¸€IDï¼‰ï¼Œåº”ç”¨å±‚å¯æ®æ­¤IDæ¥æ‰¾åˆ°åŸå…ˆå·²å‘ç”Ÿçš„æ¶ˆæ¯å¹¶å¯åœ¨UIæ˜¯å°†å…¶æ ‡è®°ä¸ºâ€å·²é€è¾¾â€œæˆ–â€å·²è¯»â€œä»¥ä¾¿æå‡ç”¨æˆ·ä½“éªŒ
     */
    emiter.on(SocketEvent.SOCKET_EVENT_MESSAGE_BE_RECIEVED, (theFingerPrint: string) =>{
      if (theFingerPrint) {
        this.getLog().info('[åº”ç”¨å±‚]  æ”¶åˆ°å¯¹æ–¹å·²æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶çš„é€šçŸ¥å“¦ğŸ˜ï¼Œfp=' + theFingerPrint);

        // æ›´æ–°å·²é€è¾¾æ¶ˆæ¯çš„å‘é€çŠ¶æ€ï¼ˆMessageProvider.updateMessageSendStatus()æ–¹æ³•ä¸­ä¼šåŒæ—¶é€šçŸ¥uiå±‚è¿›è¡Œåˆ·æ–°æ˜¾ç¤ºï¼‰
        this.messageProvider.updateMessageSendStatus(theFingerPrint, MsgSendStatus.beReceived);
      }
    });

    /* â€œè‡ªåŠ¨é‡è¿å°è¯•ä¸­â€äº‹ä»¶ */
    emiter.on(SocketEvent.SOCKET_EVENT_RECONNECT_ATTEMPT, (code: number) =>{
      if(code === 2) {
        this.getLog().error('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯ SOCKET_EVENT_RECONNECT_ATTEMPT äº‹ä»¶å·²è§¦å‘ğŸ”— (code=' + code + ')');
      }
    });

    /* å¿ƒè·³åŒ…å·²å‘å‡ºäº‹ä»¶ */
    emiter.on(SocketEvent.SOCKET_EVENT_PING, () =>{
      // this.getLog().info('[åº”ç”¨å±‚]  å¿ƒè·³è¯·æ±‚å·²å‘å‡º ğŸ˜â†’');
      emiter.emit(UIEvent.UIEVENT_onIMPing);
    });

    /* å¿ƒè·³å“åº”å·²æ”¶åˆ°äº‹ä»¶ */
    emiter.on(SocketEvent.SOCKET_EVENT_PONG, () =>{
      // this.getLog().info('[åº”ç”¨å±‚]  å¿ƒè·³å“åº”å·²æ”¶åˆ° â† ğŸ˜');
      emiter.emit(UIEvent.UIEVENT_onIMPong);
    });

    /* â€œè¢«è¸¢â€äº‹ä»¶ï¼ˆæ­¤äº‹ä»¶ç”±æœåŠ¡ç«¯æ£€æµ‹åˆ°å½“å‰loginUserIdå·²ç»åˆ«å¤„ç™»é™†æ—¶å‘å‡ºï¼‰ */
    emiter.on(SocketEvent.SOCKET_EVENT_KICKOUT, (kickoutInfo: PKickoutInfo) => {
      this.getLog().error('[åº”ç”¨å±‚]  æœ¬å®¢æˆ·ç«¯ SOCKET_EVENT_KICKOUT äº‹ä»¶å·²è§¦å‘ğŸˆ²ï¼ŒkickoutInfo=' + JSON.stringify(kickoutInfo));

      // UIå±‚å»å®ç°è¿™ä¸ªè¢«è¸¢äº‹ä»¶åçš„å¤„ç†é€»è¾‘ï¼ˆæ¯”å¦‚å¼¹æç¤ºæ¡†ï¼Œç¡®è®¤åé€€å‡ºåˆ°ç™»é™†ç•Œé¢ç­‰ï¼‰
      emiter.emit(UIEvent.UIEVENT_onKickout, kickoutInfo);
    });
  }

  /**
   * å–æ¶ˆæ³¨å†ŒMobileIMSDKæ¡†æ¶å¼€æ”¾å„ç§äº‹ä»¶ç›‘å¬ã€‚
   */
  private unregisterSocketEvent() {
    let emiter: common.EventHub = this.getEmitter();
    // æ¸…ç©ºè®¾ç½®çš„å„ç§å›è°ƒ
    emiter.off(SocketEvent.SOCKET_EVENT_ON_LOGIN_RESPONSE);
    emiter.off(SocketEvent.SOCKET_EVENT_ON_LINK_CLOSE);
    emiter.off(SocketEvent.SOCKET_EVENT_ON_RECIEVE_MESSAGE);
    emiter.off(SocketEvent.SOCKET_EVENT_ON_ERROR_RESPONSE);
    emiter.off(SocketEvent.SOCKET_EVENT_MESSAGE_LOST);
    emiter.off(SocketEvent.SOCKET_EVENT_MESSAGE_BE_RECIEVED);
    emiter.off(SocketEvent.SOCKET_EVENT_RECONNECT_ATTEMPT);
    emiter.off(SocketEvent.SOCKET_EVENT_PING);
    emiter.off(SocketEvent.SOCKET_EVENT_PONG);
    emiter.off(SocketEvent.SOCKET_EVENT_KICKOUT);
  }

  /**
   * é‡ç½®æœ¬ç±»çš„åˆå§‹åŒ–æ ‡è¯†ã€‚
   */
  resetInitFlag(): void {
    this.init = false;
  }

  /**
   * è¿”å›æœ¬ç±»æŒæœ‰çš„äº‹ä»¶è®¢é˜…å¯¹è±¡å¼•ç”¨ã€‚
   *
   * @returns äº‹ä»¶è®¢é˜…å¯¹è±¡å¼•ç”¨
   */
  getEmitter(): common.EventHub {
    return ClientCoreSDK.getInstance().getEventHub();
  }

  /**
   * è¿”å›æ—¥å¿—å¯¹è±¡ã€‚
   *
   * @returns Loggerå¯¹è±¡
   */
  getLog() :Logger {
    return ClientCoreSDK.Log;
  }

  /**
   * è¿”å›èŠå¤©æ¶ˆæ¯çš„ç¼“å­˜æ•°æ®æä¾›è€…å¯¹è±¡ã€‚
   *
   * @returns
   */
  getMessageProvider() {
    return this.messageProvider;
  }
}